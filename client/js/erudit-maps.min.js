function pushInfoWidget(t){if($("#winfo-"+t.key).length>0)return!1;var e="<div class='tool-box-widget' id='winfo-"+t.key+"'>    <span class='widget-close' onclick='$(this).parent().remove();'>x</span><h2>"+t.value.title+"</h2><p>Journal: "+t.value.journal+"<br/>Author: "+t.value.author+"<br/>Year: "+t.value.year+"<br/>Period: "+t.value.period+"</p></div>";return $("#tool-box").append(e),openSideBar(),!0}function openSideBar(){+$("#tool-box").css("right").replace("px","")<0&&toggleSideBar()}function closeSideBar(){0==+$("#tool-box").css("right").replace("px","")&&toggleSideBar()}function toggleSideBar(){+$("#tool-box").css("right").replace("px","")<0?$("#tool-box").css("right",0):$("#tool-box").css("right",-$("#tool-box").width()-15)}var map=new google.maps.Map(d3.select("#map").node(),{zoom:5,minZoom:3,maxZoom:6,center:new google.maps.LatLng(55,-72),mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!1,scaleControl:!1,streetViewControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER}});d3.json("/entities",function(t,e){if(t)throw t;var o=new google.maps.OverlayView;o.onAdd=function(){var t=d3.select(this.getPanes().overlayMouseTarget).append("div").attr("class","stations"),a={};o.draw=function(){function o(t){var e,o,l,s,i;$(this).empty(),dsrc=new google.maps.LatLng(a[t.source][0],a[t.source][1]),dtrg=new google.maps.LatLng(a[t.target][0],a[t.target][1]),d1=n.fromLatLngToDivPixel(dsrc),d2=n.fromLatLngToDivPixel(dtrg),d1.y<d2.y?(e=d1.y,o=d2.y):(e=d2.y,o=d1.y),d1.x<d2.x?(l=d1.x,s=d2.x):(l=d2.x,s=d1.x),i=d3.select(this).style("left",l+r+"px").style("top",e+r+"px").style("width",s-l-r+"px").style("height",o-e-r+"px");var d,c,p,g;return d1.y<d2.y&&d1.x<d2.x||d1.x>d2.x&&d1.y>d2.y?(d=0,c=s-l,p=0,g=o-e):(d1.y<d2.y&&d1.x>d2.x||d1.x<d2.x&&d1.y>d2.y)&&(d=s-l,c=0,p=0,g=o-e),i.append("svg:line").style("stroke-width",1).style("stroke","black").attr("x1",d).attr("y1",p).attr("x2",c).attr("y2",g).attr("class","link-"+t.source).attr("id","link-"+t.source+"-"+t.target),i}function l(t){return a[t.key]=[t.value.lat,t.value.lng],t=new google.maps.LatLng(t.value.lat,t.value.lng),t=n.fromLatLngToDivPixel(t),d3.select(this).style("left",t.x-s+"px").style("top",t.y-s+"px")}var r=1,n=this.getProjection(),s=10;t.selectAll("svg").data(d3.entries(e.documents)).each(l).enter().append("svg").each(l).attr("class","marker").attr("id",function(t){return"map-node-"+t.key}).on("mouseover",function(t){d3.select(this).selectAll("circle").attr({fill:"orange",r:9})}).on("mouseout",function(t){d3.select(this).selectAll("circle").attr({fill:"brown",r:4.5})}).on("click",function(t){pushInfoWidget(t)}).append("circle").attr("r",4.5).attr("cx",s).attr("cy",s);t.selectAll(".links").data(e.links).each(o).enter().append("svg:svg").attr("class","links").each(o)}},o.setMap(map)}),$(document).ready(function(){$("#tool-box").width(.2*$(window).width())});